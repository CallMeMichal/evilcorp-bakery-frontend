<!-- src/app/presentation/pages/checkout-page/checkout-page.html -->
<div class="page-container checkout-container">
  <app-header></app-header>
  
  <section class="checkout-section">
    <div class="container">
      <div class="checkout-header">
        <button class="back-button" (click)="goBack()">
          <i class="fas fa-arrow-left"></i>
          Back to Shopping
        </button>
        <h1>Checkout</h1>
      </div>

      <div class="checkout-content">
        <div class="left-column">
          <!-- Delivery Method Section -->
          <div class="delivery-method-section">
            <h2>Delivery Method</h2>
            <div class="delivery-options">
              <div 
                class="delivery-option" 
                [class.selected]="deliveryMethod === 'delivery'"
                (click)="selectDeliveryMethod('delivery')">
                <i class="fas fa-shipping-fast"></i>
                <div class="option-info">
                  <h3>Home Delivery</h3>
                  <p>Delivery to your address</p>
                </div>
                <i class="fas fa-check-circle selected-icon"></i>
              </div>

              <div 
                class="delivery-option" 
                [class.selected]="deliveryMethod === 'pickup'"
                (click)="selectDeliveryMethod('pickup')">
                <i class="fas fa-store"></i>
                <div class="option-info">
                  <h3>Store Pickup</h3>
                  <p>Pick up from our bakery</p>
                </div>
                <i class="fas fa-check-circle selected-icon"></i>
              </div>
            </div>
          </div>

          <!-- Delivery Address Section (only for home delivery) -->
          <div class="address-section" *ngIf="deliveryMethod === 'delivery'">
            <div class="section-header">
              <h2>Delivery Address</h2>
              <button class="add-address-btn" (click)="toggleAddressForm()" *ngIf="addresses.length > 0">
                <i class="fas fa-plus"></i>
                Add New Address
              </button>
            </div>

            <!-- Address Selection -->
            <div class="address-list" *ngIf="addresses.length > 0 && !showAddressForm">
              <div 
                class="address-card" 
                *ngFor="let address of addresses"
                [class.selected]="isAddressSelected(address)"
                (click)="selectAddress(address)">
                <div class="address-header">
                  <span class="address-label">{{address.label}}</span>
                  <div class="badges">
                    <span class="default-badge" *ngIf="address.isDefault">Default</span>
                    <span class="selected-badge-header" *ngIf="isAddressSelected(address)">SELECTED</span>
                  </div>
                </div>
                <div class="address-details">
                  <p>{{address.street}}</p>
                  <p>{{address.postalCode}} {{address.city}}</p>
                  <p>{{address.country}}</p>
                  <p>{{address.phoneAreaCode}} {{address.phoneNumber}}</p>
                </div>
              </div>
            </div>

            <!-- Address Form -->
            <div class="address-form" *ngIf="showAddressForm">
              <form (ngSubmit)="saveAddress()">
                <div class="form-row">
                  <div class="form-group">
                    <label>Label <span class="required">*</span></label>
                    <input 
                      type="text" 
                      [(ngModel)]="newAddress.label"
                      name="label"
                      placeholder="e.g., Home, Work" 
                      required />
                  </div>
                </div>

                <div class="form-group">
                  <label>Street Address <span class="required">*</span></label>
                  <input 
                    type="text" 
                    [(ngModel)]="newAddress.street"
                    name="street"
                    placeholder="Street and number" 
                    required />
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Postal Code <span class="required">*</span></label>
                    <input 
                      type="text" 
                      [(ngModel)]="newAddress.postalCode"
                      name="postalCode"
                      placeholder="00-000" 
                      required />
                  </div>
                  <div class="form-group">
                    <label>City <span class="required">*</span></label>
                    <input 
                      type="text" 
                      [(ngModel)]="newAddress.city"
                      name="city"
                      placeholder="City" 
                      required />
                  </div>
                </div>

                <div class="form-group">
                  <label>Country <span class="required">*</span></label>
                  <input 
                    type="text" 
                    [(ngModel)]="newAddress.country"
                    name="country"
                    placeholder="Country" 
                    required />
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Area Code <span class="required">*</span></label>
                    <input 
                      type="text" 
                      [(ngModel)]="newAddress.phoneAreaCode"
                      name="phoneAreaCode"
                      placeholder="+48" 
                      required />
                  </div>
                  <div class="form-group">
                    <label>Phone Number <span class="required">*</span></label>
                    <input 
                      type="text" 
                      [(ngModel)]="newAddress.phoneNumber"
                      name="phoneNumber"
                      placeholder="123456789" 
                      required />
                  </div>
                </div>

                <div class="form-checkbox">
                  <input 
                    type="checkbox" 
                    id="default"
                    [(ngModel)]="newAddress.isDefault"
                    name="isDefault" />
                  <label for="default">Set as default address</label>
                </div>

                <div class="form-actions">
                  <button 
                    type="button" 
                    class="btn-secondary" 
                    (click)="toggleAddressForm()" 
                    *ngIf="addresses.length > 0"
                    [disabled]="isSavingAddress">
                    Cancel
                  </button>
                  <button 
                    type="submit" 
                    class="btn-primary"
                    [disabled]="isSavingAddress">
                    {{ isSavingAddress ? 'Saving...' : 'Save Address' }}
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Pickup Location (only for store pickup) -->
          <div class="pickup-location-section" *ngIf="deliveryMethod === 'pickup'">
            <h2>Pickup Location</h2>
            <div class="location-card">
              <i class="fas fa-map-marker-alt"></i>
              <div class="location-details">
                <h3>Sweet Bakery - Main Store</h3>
                <p>ul. Cukiernicza 15</p>
                <p>00-123 Warszawa</p>
                <p>Poland</p>
                <p class="phone">+48 22 123 45 67</p>
                <div class="hours">
                  <i class="fas fa-clock"></i>
                  <span>Mon-Fri: 7:00 - 20:00, Sat-Sun: 8:00 - 18:00</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Notes Section -->
          <div class="notes-section">
            <h2>Order Notes (Optional)</h2>
            <p class="notes-description">
              Add any special instructions or requests for your order
            </p>
            <textarea 
              class="order-notes"
              [(ngModel)]="orderNotes"
              placeholder="E.g., Please ring the doorbell, leave at the door, allergy information, etc."
              rows="4"
              maxlength="500">
            </textarea>
            <span class="character-count">{{orderNotes.length}}/500</span>
          </div>

          <div class="payment-section">
            <h2>Payment Methods</h2>
            
            <p class="payment-instruction">
              Select your preferred payment method
            </p>
            
            <div class="payment-methods">
              <!-- Cash on Pickup - tylko dla odbioru osobistego -->
              <button 
                class="payment-button cash-payment" 
                [class.selected]="selectedPaymentMethodId === 6"
                (click)="payWithCash()" 
                *ngIf="deliveryMethod === 'pickup'">
                <i class="fas fa-money-bill-wave"></i>
                <span>Cash on Pickup</span>
                <i class="fas fa-check-circle selected-icon"></i>
              </button>

              <button 
                class="payment-button blik" 
                [class.selected]="selectedPaymentMethodId === 1"
                (click)="payWithBlik()">
                <i class="fas fa-mobile-alt"></i>
                <span>BLIK</span>
                <i class="fas fa-check-circle selected-icon"></i>
              </button>

              <button 
                class="payment-button credit-card" 
                [class.selected]="selectedPaymentMethodId === 2"
                (click)="payWithCreditCard()">
                <i class="fas fa-credit-card"></i>
                <span>Credit Card</span>
                <i class="fas fa-check-circle selected-icon"></i>
              </button>

              <button 
                class="payment-button paypal" 
                [class.selected]="selectedPaymentMethodId === 3"
                (click)="payWithPayPal()">
                <i class="fab fa-paypal"></i>
                <span>PayPal</span>
                <i class="fas fa-check-circle selected-icon"></i>
              </button>

              <button 
                class="payment-button apple-pay" 
                [class.selected]="selectedPaymentMethodId === 4"
                (click)="payWithApplePay()">
                <i class="fab fa-apple"></i>
                <span>Apple Pay</span>
                <i class="fas fa-check-circle selected-icon"></i>
              </button>

              <button 
                class="payment-button google-pay" 
                [class.selected]="selectedPaymentMethodId === 5"
                (click)="payWithGooglePay()">
                <i class="fab fa-google"></i>
                <span>Google Pay</span>
                <i class="fas fa-check-circle selected-icon"></i>
              </button>
            </div>

            <button class="go-to-summary-btn" (click)="goToSummary()" [disabled]="!selectedPaymentMethodId">
              <span>Continue to Summary</span>
              <i class="fas fa-arrow-right"></i>
            </button>

            <div class="secure-checkout">
              <i class="fas fa-lock"></i>
              <span>Your payment information is secure and encrypted</span>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <h2>Order Summary</h2>
          
          <div class="order-items">
            <div class="order-item" *ngFor="let item of cartItems">
              <div class="item-image">
                <img [src]="item.base64Image" [alt]="item.name" />
              </div>
              <div class="item-details">
                <h3>{{item.name}}</h3>
                <p class="item-quantity">Quantity: {{item.quantity}}</p>
                <p class="item-price">{{formatPrice(item.price)}} each</p>
              </div>
              <div class="item-total">
                {{formatPrice(item.price * item.quantity)}}
              </div>
            </div>
          </div>

          <div class="order-totals">
            <div class="total-row">
              <span>Subtotal:</span>
              <span>{{formatPrice(subtotal)}}</span>
            </div>
            <div class="total-row" *ngIf="deliveryMethod === 'delivery'">
              <span>Shipping:</span>
              <span>{{formatPrice(shipping)}}</span>
            </div>
            <div class="total-row total-final">
              <span><strong>Total:</strong></span>
              <span><strong>{{formatPrice(cartTotal)}}</strong></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <app-footer></app-footer>
</div>