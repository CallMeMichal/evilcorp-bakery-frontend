<header class="header">
  <div class="container">
    <div class="nav-brand" (click)="goHome()">
      <i class="fas fa-birthday-cake"></i>
      <span>Sweet Bakery</span>
    </div>
    
    <nav class="nav-menu">
      <a href="/" class="nav-link">Home</a>
      <a href="/products" class="nav-link">Products</a>
      <a href="/about" class="nav-link">About</a>
      <a href="/contact" class="nav-link">Contact</a>
    </nav>
    
    <!-- Auth and Cart Section -->
    <div class="header-actions">
      <!-- Search Bar for logged in users -->
      <div class="search-container" *ngIf="isLoggedIn">
        <div class="search-input-wrapper">
          <input 
            #searchInput
            type="text" 
            placeholder="Search products..." 
            class="search-input"
            [(ngModel)]="searchQuery"
            (input)="onSearchInput($event)"
            (keydown)="onSearchKeyDown($event)"
            (blur)="hideSuggestions()"
            autocomplete="off"
          />
          <button 
            class="search-button" 
            (click)="performSearch()"
            *ngIf="!isLoadingSuggestions"
          >
            <i class="fas fa-search"></i>
          </button>
          <div *ngIf="isLoadingSuggestions" class="search-loading">
            <i class="fas fa-spinner fa-spin"></i>
          </div>
          <button 
            *ngIf="searchQuery && !isLoadingSuggestions" 
            class="clear-search-btn"
            (click)="clearSearch()"
            type="button"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- Suggestions Dropdown -->
        <div class="search-suggestions" *ngIf="showSuggestions && suggestions.length > 0">
          <div 
            *ngFor="let suggestion of suggestions; let i = index"
            class="suggestion-item"
            [class.selected]="i === selectedSuggestionIndex"
            (mousedown)="selectSuggestion(suggestion)"
          >
            <div class="suggestion-image">
              <img [src]="suggestion.base64Image" [alt]="suggestion.name" />
            </div>
            <div class="suggestion-content">
              <div class="suggestion-name">{{suggestion.name}}</div>
              <div class="suggestion-price">{{formatPrice(suggestion.price)}}</div>
            </div>
            <div class="suggestion-stock" [class.out-of-stock]="suggestion.stock === 0">
              <i class="fas" [class.fa-check]="suggestion.stock > 0" [class.fa-times]="suggestion.stock === 0"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Auth Buttons for non-logged users -->
      <div class="auth-buttons" *ngIf="!isLoggedIn">
        <button class="btn-sign-in" (click)="signIn()">Sign In</button>
        <button class="btn-register" (click)="register()">Register</button>
      </div>

      <!-- Cart Icon -->
      <div class="cart-container" *ngIf="isLoggedIn">
        <button class="cart-button" (click)="toggleCartModal()">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-count" *ngIf="cartCount > 0">{{cartCount}}</span>
        </button>
      </div>

      <!-- User Profile for logged in users -->
      <div class="profile-container" *ngIf="isLoggedIn && userInfo">
        <button class="profile-button" (click)="navigateToProfile()">
          <div class="profile-avatar">{{ userInfo.name.charAt(0).toUpperCase() }}</div>
          <div class="profile-info">
            <span class="profile-name">{{ userInfo.name }} {{ userInfo.surname }}</span>
            <span class="profile-role">{{ userInfo.role }}</span>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Cart Modal (bez zmian) -->
  <div class="cart-modal-overlay" *ngIf="showCartModal" (click)="closeCartModal()">
    <div class="cart-modal" (click)="$event.stopPropagation()">
      <div class="cart-modal-header">
        <h3>Shopping Cart</h3>
        <button class="close-button" (click)="closeCartModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="cart-modal-content">
        <div *ngIf="cartItems.length === 0" class="empty-cart">
          <i class="fas fa-shopping-cart"></i>
          <p>Your cart is empty</p>
        </div>

        <div *ngIf="cartItems.length > 0">
          <div class="cart-item" *ngFor="let item of cartItems">
            <div class="item-image">
              <img [src]="item.base64Image" [alt]="item.name" />
            </div>
            <div class="item-details">
              <h4>{{item.name}}</h4>
              <p class="item-price">{{formatPrice(item.price)}}</p>
            </div>
            <div class="quantity-controls">
              <button 
                class="quantity-btn" 
                (click)="updateQuantity(item.id, item.quantity - 1)"
                [disabled]="item.quantity <= 1"
              >
                <i class="fas fa-minus"></i>
              </button>
              <span class="quantity">{{item.quantity}}</span>
              <button 
                class="quantity-btn" 
                (click)="updateQuantity(item.id, item.quantity + 1)"
                [disabled]="item.quantity >= item.stock"
              >
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="item-total">
              {{formatPrice(item.price * item.quantity)}}
            </div>
            <button class="remove-btn" (click)="removeFromCart(item.id)">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="cart-modal-footer" *ngIf="cartItems.length > 0">
        <div class="cart-total">
          <strong>Total: {{formatPrice(cartTotal)}}</strong>
        </div>
        <div class="cart-actions">
          <button class="btn-clear" (click)="clearCart()">Clear Cart</button>
          <button class="btn-checkout" (click)="checkout()">Checkout</button>
        </div>
      </div>
    </div>
  </div>
</header>